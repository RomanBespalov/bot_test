{% extends "admin_custom/base.html" %}
{% load static %}
{% block content %}
<div>
    <h2>Название рассылки: {{ broadcast.name }}</h2>
</div>
<div id="filters" style="position: absolute; top: 200px; right: 200px;">
    <form name="base_form" method="post" action="{% url 'broadcast_detail' broadcast.id %}">
        {% csrf_token %}
        <button type="submit">Сбросить фильтр</button>
    </form>
    <form name="button_form" method="post" action="{% url 'broadcast_detail' broadcast.id %}">
        {% csrf_token %}
        <h2>Фильтр по нажатым кнопкам</h2>
        <input type="text" name="button_filter" placeholder="Введите название кнопки" value="{{ request.POST.button_filter }}">
        <button type="submit">Применить фильтр</button>
    </form>
    <form name="blocked" method="post" action="{% url 'broadcast_detail' broadcast.id %}">
        {% csrf_token %}
        <h2>Фильтр по заблокированным юзерам</h2>
        <button type="submit" name="blocked" formaction="{% url 'broadcast_detail' broadcast.id %}">Показать заблокированных юзеров</button>
    </form>
    <form name="not_blocked" method="post" action="{% url 'broadcast_detail' broadcast.id %}">
        {% csrf_token %}
        <button type="submit" name="not_blocked" formaction="{% url 'broadcast_detail' broadcast.id %}">Показать не заблокированных юзеров</button>
    </form>
</div>
{% if blocked %}
    Включен фильтр по заблокированным юзерам
{% endif %}
{% if not_blocked %}
    <h4>Включен фильтр по не заблокированным юзерам</h4>
{% endif %}
{% if filtered_users %}
    <span>
        Включен фильтр - Нажатые кнопки:
        {% for butt in butts %}
            {{ butt }}
            {% if not forloop.last %}, {% endif %}
        {% endfor %}
    </span>
{% endif %}
{% if not flag %}
    Юзеров по данному фильтру нет!
{% endif %}
{% for user, data in user_buttons_dict.items %}
    <div>
        <p><h4>Пользователь: {{ user.name }}</h4>
        <h4>Статус пользователя: {% if data.1 %} Заблокирован {% else %} Не заблокирован {% endif %}</h4></p>
        <h4>Нажатые кнопки:</h4>
        <ul>
            {% for button in data.0 %}
                <li>{{ button.button.name }} - {{ button.count }} раз</li>
            {% endfor %}
        </ul>
    </div>
<hr>
{% endfor %}
{% include 'admin_custom/includes/paginator.html' %}
{% endblock %}
